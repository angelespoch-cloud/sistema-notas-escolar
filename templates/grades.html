{% extends 'base.html' %}
{% block title %}Edición de notas{% endblock %}
{% block content %}
<h2 class="mb-3">Edición rápida de notas</h2>

<form method="get" class="row g-2 align-items-end mb-3">
  <div class="col-md-8">
    <label class="form-label">Selecciona una asignación</label>
    <select name="assignment_id" class="form-select" onchange="this.form.submit()">
      <option value="">Curso - Materia - Docente</option>
      {% for a in assignments %}
        <option value="{{ a.id }}" {% if selected_assignment == a.id %}selected{% endif %}>{{ a.label }}</option>
      {% endfor %}
    </select>
  </div>
</form>

{% if selected_assignment %}
<form method="post" class="card card-body">
  <input type="hidden" name="assignment_id" value="{{ selected_assignment }}">
  <div class="table-responsive">
    <table class="table align-middle">
      <thead><tr><th>Estudiante</th><th>Código</th><th style="width: 150px;">Nota (0-20)</th></tr></thead>
      <tbody>
      {% for row in rows %}
      <tr>
        <td>{{ row.full_name }}</td>
        <td>{{ row.student_code }}</td>
        <td><input class="form-control" type="number" step="0.01" min="0" max="20" name="grade_{{ row.enrollment_id }}" value="{{ row.grade if row.grade is not none else '' }}"></td>
      </tr>
      {% else %}
      <tr><td colspan="3" class="text-center py-3">No hay estudiantes matriculados en este curso.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
  <div><button class="btn btn-success">Guardar notas</button></div>
</form>
{% else %}
<div class="alert alert-info">Primero selecciona un curso + materia para cargar la tabla editable.</div>
{% endif %}
{% endblock %}
